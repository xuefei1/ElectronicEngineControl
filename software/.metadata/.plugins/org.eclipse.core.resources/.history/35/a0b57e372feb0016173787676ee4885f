/*
 * ui_proc.c
 *
 * Status: C
 *
 *  Created on: Feb 4, 2017
 *      Author: xuefei1
 *
 *      This process is mostly used for debugging
 *      for now, it only interfaces with the LCD
 *      so we could also call it lcd_task
 */

#include "ui_proc.h"

/* Used to store debug msg */
OS_EVENT *lcd_msg_q;

char lcd_msg_buf[LCD_MSG_Q_SIZE_BYTE];

void ui_task(void* pdata) {
	static INT32U last_count = 0;
	  INT8U err;
	  alt_up_character_lcd_dev *lcd;
	  lcd = alt_up_character_lcd_open_dev(CHARACTER_LCD_0_NAME);
	  alt_up_character_lcd_init(lcd);
	  char str[15];
	  while (1)
	  {
		INT32U count = *(INT32U *)OSQPend(msg_q, OS_Q_PEND_WAIT_FOREVER, &err);
		if(err) disp_err(err, "Error pending on q");
		sprintf(str, "%Lu", count - last_count);
		last_count = count;
		alt_up_character_lcd_init(lcd);
		alt_up_character_lcd_set_cursor_pos(lcd, LCD_CURSOR_START_ROW_1_X, LCD_CURSOR_START_ROW_1_Y);
		alt_up_character_lcd_string(lcd, str);
	    err = OSTimeDlyHMSM(OS_TIME_LCD_DELAY_HOURS, OS_TIME_LCD_DELAY_MINUTES, OS_TIME_LCD_DELAY_SECONDS, OS_TIME_LCD_DELAY_MILLISEC);
	    if(err) disp_err(err, "Error delaying");
	  }
}
